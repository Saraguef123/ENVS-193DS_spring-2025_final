---
title: "ENVS-193DS Final"
author: "Sara Guefroudj"
date: 6/11/2025
format:
  html:
    toc: true # This line enables the Table of Contents
    toc-depth: 3 
---
[View this Github Repo](https://github.com/Saraguef123/ENVS-193DS_spring-2025_final)

# Final Set Up

```{r setup, warning = FALSE, message=FALSE}

 library(tidyverse)
library(janitor)
library(gt)
library(effsize)
library(here)
library(readxl)
library(scales)
library(ggeffects)
library(MuMIn)
library(dplyr)
library(RColorBrewer)
library(DHARMa)
sst <- read.csv(here("data","SST_update2023.csv"))
nest_boxes <- read.csv(here("data","occdist.csv"))

```

# Problem 1: Research Writing

## a.) Transparent statistical methods
In part 1 they used a person's R test because they specifically  state no correlation indicating that they are seeing if there is a correlation between the two variables being annual total nitrogen load and headwater distance. In addition they use numerical variables which indicate it's a persons test and not a spearman's test. In part 2 they use a one- way Anova test because the test describes how they are comparing means of different sources being urban land, fertilizer, and wastewater treatment across the one factor which is nitrogen load(kg year-1)

## b.) More information needed
One additional part  in part 2 the author could have addressed is a Post-HOC: Tukey HSD test because it would be meaningful to know which sources are different from each other. For example is there a difference in average nitrogen load between fertilizers and urban land.
Another addition they could have mentioned is the effective size because it would be more descriptive to know the magnitude of the differences between sources, not just saying they are significant with a p value because there could be a significant p value but we want to  know the magnitude and what it means in the context of the problem.

## c.)
We found a (size difference (η2= effect size) difference in average nitrogen load between sources(one-way ANOVA, F(?, ?) = value, p < 0.02, α = significance level).


# Problem 2. Data visualization 

##a.) Cleaning and Summarizing 
```{r}
sst_clean <- sst |> 
  clean_names() |> 
  select(temp,date) |> 
  mutate(
    date = mdy(date),
    year = year(date),
    month = month(date, label= TRUE, abbr = TRUE),
    month = as_factor(month),
    month = fct_relevel(
month,
"Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
  ) |> 
filter(year %in% c(2018,2019,2020,2021,2022,2023)) |> 
  mutate(year = as_factor(year)) |> 
group_by(year,month) |> 
  summarize(
    mean_monthly_sst = round(mean(temp), 1),
    .groups = "drop")
sst_clean |> 
  ungroup() |> 
  select(year,month, mean_monthly_sst) |> 
  slice_sample(n = 5)
```

```{r}
str(sst_clean)
```

## b. Visualize the data 
```{r}
ggplot(data = sst_clean,
       aes(x=month,
           y= mean_monthly_sst,
           color = year,
           group = year))+
geom_point() +
  geom_line()+

labs(
  x = "Month",
  y = "Mean monthly sea surface temperature(°C)",
  color = "Year"
)  
  #scale_color_manual(values = )+
 #theme_classic()
  #theme(
#panel.grid.major = element_blank(),
#panel.grid.minor = element_blank(),
#panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
#legend.position = c(0.1,0.7))
#makes a gray border
    
  

```

# Problem 3. Data analysis

## a. Response variable
The 1s and 0s in this data describes if the nest boxes were occupied by each species with 0 being no and 1 being yes.

## b. Purpose of study
Swift parrots are an endangered species and the nest boxes were intended for them however they have different breeding patterns that lead to them not nesting in same location. Non target species are the common sterling which are native to the study area and can exploit the nest boxes. The tree martins however are nest competitors with both the common sterling and swift parrot

## c. Difference in “seasons”
the authors present data from the years 2016 and 2019. They used data specifically from each year during the breeding season of the Swift parrots in 2016 and 2019 specifically a that season that had a mast tree flowering event that had set off a breeding event

##d. Table of models 
## Table of Models

| Model number | Year (Season) | Distance to forest edge | Model description                     |
|:------------:|:-------------:|:------------------------:|----------------------------------------|
| 0            | No            | No                       | no predictors (Null model)             |
| 1            | Yes           | No                       | Season  only                           |
| 2            | No            | Yes                      | Distance to forest edge                |
| 3            | Yes           | Yes                      | all predictors (full model)  

## e. cleaning data/Run the models
```{r}
nest_boxes_clean <- nest_boxes |> 
  clean_names() |> 
  mutate(box_occupant = case_match(
    box_occupant,
    "common starling" ~ "Sturnus vulgaris",
    "swift parrot" ~ "Lathamus discolor",
    "tree martin" ~ "Petrochelidon nigricans")
  ) |> 
  mutate(season = as_factor(season)) |>        
  rename(sp_occupant=sp) |> 
 select(edge_distance, season, sp_occupant) |> 
drop_na() 

```

```{r}
  
model0 <- glm(sp_occupant~1,
              data = nest_boxes_clean,
              family = "binomial")

model3 <- glm(sp_occupant ~edge_distance + season,
              data = nest_boxes_clean,
               family = "binomial")
              
model2 <- glm(sp_occupant ~ edge_distance,
              data = nest_boxes_clean,
               family = "binomial")
model1 <- glm(sp_occupant~ season,
              data = nest_boxes_clean,
               family = "binomial")
```

```{r model-diagnostics}
par(mfrow = c(2, 2)) # displays plots in a 2x2 grid
plot(model0)
plot(model1)
plot(model2)
plot(model3)
```
## g. Select the best model
```{r}
AICc(model0,
     model1,
     model2,
     model3 
     ) |> 
  # arranging output in descending order of AIC
  arrange(AICc)
```
The best model as determined by Akaike's Information Criterion(AIC) included predictors edge distance and seasons(2016 and 2019) and the response is if swift parrot was present(occupied=1, not occupied =0)

##h. Visualize the model predictions
```{r}
model_preds <- ggpredict(model3,
                         terms = c(
                                   "edge_distance",
                                   "season"))
```

```{r}
model_preds_plotting <-  model_preds |> # using model preds data frame to create object for momdel prediction plotting
  rename(edge_distance = x,  season = group) #renaming edge distance column

ggplot() +
  geom_jitter(data=nest_boxes_clean, #uses nest boxes clean data frame
              aes(x= edge_distance, y= sp_occupant, color = season), #uses orginal data for underlying points
              alpha = 0.2, #makes points transparent
              width = 0.1, #jitter horizontally
              height = 0) + #no vertical jitter
  geom_line(data= model_preds_plotting, #uses model_preds_plotting data frame
             aes(x= edge_distance, #x-axis as edge distance
                 y= predicted, color = season))+  # predicted probability for model
  geom_ribbon(data=model_preds_plotting, #uses model_preds_plotting data frame
              aes(x= edge_distance, # x-axis as edge distance
                  ymin = conf.low, 
                  ymax = conf.high, fill= season), #lower and upper bounds of CI
              alpha= 0.15) +
  labs(
    title = "Predicted Nest Box Occupancy of Swift Parrot\n by edge distance and season",
    x = "Distance from forest edge(m)",
    y= "Swift Parrot Nest box Occupancy") +
  
  scale_color_manual(values = c("2016" = "green", "2019" = "purple"))+
  scale_fill_manual(values = c("2016" = "green", "2019" = "purple"))+
  
  theme_classic()
```

##i. Write a caption for your figure
FIgure 1: A logistic regression linear model showing the predicted probability of swift parrot(Lathamus discolor) nest occupancy by edge distance and season. The lines represent the predicted probability of nest occupancy by the Swift Parrot from each season  The purple line represents the probability for the season of 2016 and blue line represent the season of 2019. The shaded ribbons around the lines represent the 95% confidence interval for the predicted probabilities. The individual points represent swift parrot occupancy with 1 being occupied and 0 being not occupied by the swift parrot. 
  Stojanovic, D., Owens, G., Young, C., Alves, F., & Heinsohn, R. (2021). Do nest boxes breed the target species or its competitors? A case study of a critically endangered bird [Dataset]. Dryad. https://doi.org/10.5061/dryad.83bk3j9sb
  
## j. Calculate model Predictions
```{r}
ggpredict(model3, terms = c("edge_distance [0,900]", "season"))
```


